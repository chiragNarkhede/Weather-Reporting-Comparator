package testSuit;
import baseClass.TestBase;

import org.apache.log4j.Logger;
import org.apache.log4j.PropertyConfigurator;
import org.openqa.selenium.Alert;
import org.openqa.selenium.Keys;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.interactions.Action;
import org.testng.annotations.BeforeTest;
import org.testng.annotations.Test;
import pageObjects.LandingPage;
import pageObjects.WeatherReportPage;

import org.openqa.selenium.support.PageFactory;
import org.openqa.selenium.support.ui.ExpectedConditions;
import org.openqa.selenium.support.ui.WebDriverWait;
import commonUtil.ScreenShotUtil;

import java.io.IOException;
import java.util.ArrayList;
import java.util.List;
public class ValidateSearchCityOnMap extends TestBase {
	public WebDriver driver;
	boolean setupResult =true;
	boolean testResult =true;
	boolean tearDown =true;
	public String city = "Pune";
	LandingPage landingPage;
	WeatherReportPage reportPage;
	Logger logger =Logger.getLogger(this.getClass()); 
	
	@BeforeTest
	
	public void Setup() {
	
		logger.debug("Start Setup: ValidateSearchCityOnMap");
		try 
		{
			logger.debug("Initialize Web Driver");
			driver = DriverInitializer();
			driver.get(url);
			 driver.manage().window().maximize();
			 logger.debug("Initialising Object of Landing Page.");
			 landingPage = PageFactory.initElements(driver, LandingPage.class);
			 CaptureScreenShot(driver,true);
			 String title = driver.getTitle();
			 logger.debug("Getting title of Landing Page."+title);
			 if(!title.contains("NDTV"))
			 {
				 logger.fatal("Title is not matching."+title);
				 setupResult = false;
			 }
			 logger.debug("Dismiss the Alert");
			 //Alert alert = driver.switchTo().alert();
			 //Alert alert = (Alert) wait.until(ExpectedConditions.visibilityOf(landingPage.getNotifacation()));
			 //alert.accept();
			 //driver.switchTo().alert().dismiss();
			 
			 reportPage = PageFactory.initElements(driver, WeatherReportPage.class);
			 if(landingPage.getSubMenu().isDisplayed())
			 {
				 landingPage.getSubMenu().click();
				 System.out.println("UserClicked");
				 
			 }
			 CaptureScreenShot(driver,true);
			 landingPage.getWeatherOption().click();
			 CaptureScreenShot(driver,true);
			 if(!driver.getTitle().contains("WEATHER"))
			 {
				 setupResult = false;
			 }
			 
		}catch(Exception e)
		{
			logger.fatal("Exception Occured"+e.getMessage()+e.getStackTrace());
			
		}
		finally
		{
			logger.debug("End Setup: ValidateSearchCityOnMap");
		}
		
	}
	
	@Test
	public void Test()
			
			{
			try 
			{
				String selectCityContainer = reportPage.getSearchContainerTitle().getText();
				CaptureScreenShot(driver,true);
				if(!selectCityContainer.contains("Pin your City"))
				{
					 CaptureScreenShot(driver,false);
					testResult=false;
					
				}
				logger.debug("Enter City into search box as"+city);
				reportPage.getSearchBox().sendKeys(city);
				CaptureScreenShot(driver,true);
				reportPage.getSearchBox().sendKeys(Keys.ENTER);;
				reportPage.getCheckBox(city).click();
				logger.debug("Search City on Map."+city);
				boolean cityOnMap = reportPage.getCityOnMap(city).isDisplayed();	
				logger.debug("Search City on Map.Result:"+cityOnMap);
				String degreeTemp = reportPage.getDTemperature(city).getText();
				System.out.println(degreeTemp);
				String fahrenheitTemp = reportPage.getFTemperature(city).getText();
				System.out.println(fahrenheitTemp);

				reportPage.getCityOnMap(city).click();
				System.out.println("Clicked");
				boolean popUpDisplayed = reportPage.getLeafPopUp().isDisplayed();
				String dTempPopUp =reportPage.getPopUpData("3").getText();
				
				System.out.println("dTempPopUp"+dTempPopUp);
				if(dTempPopUp.contains(degreeTemp))
				{
					System.out.println("True");
				}
				ArrayList<String> infoList = new ArrayList<String>();
				
				
			}catch(Exception e)
			{
				logger.fatal("Exception Occured"+e.getMessage()+e.getStackTrace());
				
			}
			finally
			{
				System.out.println("Executed");
			}
		}

}
